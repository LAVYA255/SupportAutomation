<!DOCTYPE html>

<html>
<head>
    <title>AI Support Inbox</title>
    <style>
        body{
            font-family: Arial;
            background:#f5f7fb;
            padding:30px;
        }
        .ticket{
            background:white;
            padding:20px;
            margin-bottom:20px;
            border-radius:12px;
            box-shadow:0 4px 12px rgba(0,0,0,0.08);
        }
        textarea{
            width:100%;
            height:120px;
            margin-top:10px;
        }
        button{
            padding:8px 16px;
            margin-top:10px;
            margin-right:10px;
            cursor:pointer;
        }
        .resolved{ border-left:6px solid green;}
        .pending{ border-left:6px solid orange;}
    </style>
</head>
<body>

<h1>ðŸ“¨ AI Support Dashboard</h1>

<button onclick="syncEmails()">Sync Inbox</button> <button onclick="loadTickets()">Refresh</button>

<div id="tickets"></div>

<script>

async function syncEmails(){
    await fetch("/sync-emails",{method:"POST"});
    loadTickets();
}

async function loadTickets(){
    const res = await fetch("/tickets");
    const tickets = await res.json();

    const container = document.getElementById("tickets");
    container.innerHTML="";

    tickets.reverse().forEach(ticket=>{
        const div = document.createElement("div");
        div.className="ticket "+ticket.status;

        div.innerHTML=`
            <h3>${ticket.subject}</h3>
            <b>${ticket.name} (${ticket.email})</b>
            <p>${ticket.message}</p>

            <h4>AI Reply:</h4>
            <textarea id="reply-${ticket.id}">${ticket.ai_reply}</textarea>


        <br>
        <button onclick="updateReply(${ticket.id})">Save Edit</button>
        <button onclick="sendReply(${ticket.id})">Send Reply</button>
        <p>Status: <b>${ticket.status}</b></p>
    `;
    container.appendChild(div);
});

}

async function updateReply(id){
const text=document.getElementById(`reply-${id}`).value;


await fetch(`/update-reply/${id}`,{
    method:"PUT",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({reply:text})
});

loadTickets();


}

async function sendReply(id){
const text=document.getElementById(`reply-${id}`).value;
await fetch(`/update-reply/${id}`,{
    method:"PUT",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({reply:text})
});
await fetch(`/send-reply/${id}`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({confirm:true})
});
loadTickets();
}

loadTickets(); </script>

</body>
</html>
